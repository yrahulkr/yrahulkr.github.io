---
layout: post
title: AVERROES - Whole-Program Analysis Without the Whole Program
date:   2013-04-04 11:39:00
permalink: /averroes/
group: research
weight: 1
---

<figure>
	<img width="50%" src="{{ "/resources/images/ave.png" |  prepend: site.baseurl }}" alt="Averroes" />
</figure>
Averroes is a tool that generates a placeholder library overapproximating the possible behaviour of the original library.
The placeholder library can be constructed quickly without analyzing the whole program (using the separate compilation
assumption), and is typically in the order of 80 kB of classes (comparatively, the Java standard library is 25 MB).
Any existing whole-program call graph construction framework can use the placeholder library as a replacement for the
actual libraries to efficiently construct a sound and precise application call graph.

{{ site.excerpt_separator }}

## Downloads ##
* <a href="https://www.dropbox.com/s/n1nv4ll3vjibaoj/averroes.jar?dl=1">averroes.jar</a>: a runnable
JAR for Averroes. Averroes requires a properties files named `averroes.properties` to run. A sample properties file can be found
<a href="{{ "/resources/averroes/downloads/averroes.properties.sample" |  prepend: site.baseurl }}">here</a>.
More details can be found in <a href="{{ "/averroes-tutorial" |  prepend: site.baseurl }}">this tutorial</a>.
Once you have the properties file created, you can run Averroes using the following commands:

``` bash
$ jar uf averroes.jar averroes.properties
$ java -jar averroes.jar
```

* <a href="https://www.dropbox.com/s/6ww9qxar4mh1ka0/averroes-all.tar.gz?dl=1">averroes-all.tar.gz</a>: the complete package download for Averroes. It contains all the Java sources and runnable JARs for Averroes, as well as the helper tools
that comes with it to view application-only call graphs, conforming to
<a href="{{ "/resources/cgc/callgraph.gxl" |  prepend: site.baseurl }}">this schema</a>.

* <a href="https://www.dropbox.com/s/dmhgpxjvw6gfd9m/cginfo.jar?dl=1">cginfo.jar</a>: a runnable JAR
for the command-line tool `CallGraphInfo`. It's an adaption of the tool `CallGraphInfo` from
<a href="http://plg.uwaterloo.ca/~olhotak/probe/" target="_blank">ProBe</a>, that is capable of processing
application-only call graphs.

* <a href="https://www.dropbox.com/s/whtqtrkm9n5szqz/cgviewer.jar?dl=1">cgviewer.jar</a>: a runnable
JAR for the HTTP viewer `CallGraphView`. It's an adaption of the tool `CallGraphView` from
<a href="http://plg.uwaterloo.ca/~olhotak/probe/" target="_blank">ProBe</a>, that is capable of processing application-only call graphs.

## Workflow ##
<figure>
	<img width="100%" src="{{ "/resources/images/averroes-workflow.png" |  prepend: site.baseurl }}" alt="Averroes Workflow" />
</figure>

## "Hello, World!" Example ##
We will now step through an example of how to use Averroes to analyze the Java `HelloWorld` program. First, download the
following file <a href="https://www.dropbox.com/s/j1bpcuyr1gfcatj/averroes.zip?dl=1">averroes.zip</a> on
your machine, then unzip it. It should unzip to a folder that contains the following files:

* <a href="https://www.dropbox.com/s/1agm2lzsh92icd2/hello.jar?dl=1">hello.jar</a>: contains the content of the HelloWorld program.
* <a href="https://www.dropbox.com/s/3bzb8igrmc00d6d/averroes.jar?dl=1">averroes.jar</a>: this is the Averroes self-contained runnable JAR file.
* <a href="https://www.dropbox.com/s/4kzuhwvfgoeipu3/rt.jar?dl=1">rt.jar</a>: the only library dependency for the input application, the JRE JAR file (version 1.4.2_11).
* <a href="{{ "/resources/averroes/example/averroes.properties" | prepend: site.baseurl }}">averroes.properties</a>: a properties file used by Averroes.
* <a href="{{ "/resources/averroes/example/hello.dynamic" | prepend: site.baseurl }}">hello.dynamic</a>: a text file that contains any classes the input program loads dynamically. It is empty in this specific example.
* <a href="{{ "/resources/averroes/example/hello.tfx" | prepend: site.baseurl }}">hello.tfx</a>: a text file containing the reflection facts from the output of <a href="http://code.google.com/p/tamiflex/">TamiFlex</a> (which is also empty in this specific example).

Now open the terminal and change to the directory that has the unzipped content of the file you downloaded. To run
Averroes, just type in the following command on the terminal:

``` bash
$ java -jar averroes.jar
```

Averroes will then output some
statistics about the input JAR files it has processed and the output library is packaged in a file called `lib.jar` in
the output directory specified in the averroes.properties file. Along with the `lib.jar` file, there is a classes
directory where all the class files generated by Averroes are located. Note that if you make any changes to the
properties file, you need to run:

``` bash
$ jar uf averroes.jar averrroes.properties
```

to update the properties file within the Averroes JAR file to reflect your changes. You can then use the placeholder
library generated by Averroes along with the original application code with any call graph construction framework
(e.g., Spark or Doop) to get the application-only call graph for the `HelloWorld` program.

## Tutorial ##
A complete step-by-step tutorial on using Averroes to analyze both the
<a href="http://sourceforge.net/projects/dacapobench/files/archive/2006-10-MR2/" target="_blank">DaCapo</a> and the
<a href="http://www.spec.org/jvm98/" target="_blank">SPEC JVM98</a> benchmarks can be found
<a href="{{ "/averroes-tutorial" | prepend: site.baseurl }}">here</a>. The output of the experiments we used
to empirically evaluate Averroes can be downloaded
<a href="https://www.dropbox.com/s/96kke8pbh3tq0qr/output.zip?dl=1">here</a>. The download contains
two folders, one for the
<a href="http://sourceforge.net/projects/dacapobench/files/archive/2006-10-MR2/" target="_blank">DaCapo</a> benchmarks,
and one for the <a href="http://www.spec.org/jvm98/" target="_blank">SPEC JVM98</a> benchmarks. Each benchmark program
used has a folder that contains the following:

* &lt;benchmark_name&gt;.stats: a text file that contains all the output from the two tools run for each benchmark:
Spark<sub>Averroes</sub>, and Doop<sub>Averroes</sub>. It contains important information like preprocessing time,
analysis time, frequencies of library call-backs, etc.
* &lt;benchmark_name&gt;-gc.stats: a text file that contains the verbose Java garbage collector output. The information
in this file is used to evaluate the memory usage of Spark and Spark<sub>Averroes</sub>.
* callgraph/: a folder that contains all the call graphs generated by the two tools as well as the difference call graphs between them.
* database/: a folder that contains the LogicBlox database used by Doop<sub>Averroes</sub> after the analysis finishes execution.
